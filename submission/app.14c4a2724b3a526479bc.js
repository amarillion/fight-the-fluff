(()=>{"use strict";var t,e={785:(t,e,i)=>{var n=i(260),s=i.n(n);const o=class extends n.Scene{constructor(){super({key:"BootScene"})}preload(){this.load.spritesheet("banana-spritesheet","./assets/images/Banana_1.png",{frameWidth:24}),this.load.spritesheet("fluff-spritesheet","./assets/images/Fluff_front1.png",{frameWidth:24}),this.load.image("startgate","./assets/images/BananaBox.png"),this.load.image("endgate","./assets/images/Ship.png"),this.load.audio("music",["./assets/music/march_of_the_fluff.mp3"])}create(){this.scene.start("MenuScene")}};var d=i(890),a=i(8);class r{constructor(t,e,i,n,s,o,d,r){this.mx=t,this.my=e,this.idx=i,this.unitXco=n,this.unitYco=s,this.xco=n+o.x*r,this.yco=s+o.y*r;const h=(0,a.vs)((0,a.Iu)(n,s),(0,a.bA)(r,r),(0,a.Iu)(o.x,o.y),(0,a.U1)(o.rotation));this.points=(0,a.qU)(h,d),this.cx=this.points.reduce(((t,e)=>t+e.x),0)/this.points.length,this.cy=this.points.reduce(((t,e)=>t+e.y),0)/this.points.length,this.element=o,this.links=[]}toString(){return`unit [${this.mx} ${this.my}] index: ${this.idx}`}static getLinks(t){return Object.entries(t.links)}static*getAdjacent(t){for(const e of r.getExits(t)){const i=e[1];for(const n of r.getExits(i))n[1]===t&&(yield e)}}static*getExits(t){const e=t.tile&&t.tile.connectionMask||0;let i=1;for(const n of r.getLinks(t))(e&i)>0&&(yield n),i*=2}}class h{constructor(t,e,i){this.x=t,this.y=e,this.grid=i,this.nodes=[]}push(t){this.nodes.push(t)}addPrimitiveUnit(t,e,i,n,s,o){const{primitiveUnit:d,unitSize:a,points:h}=s;let l=0;for(const s of d)this.push(new r(t,e,l++,i,n,s,h,o));this.xco=i,this.yco=n,this.unitSize=a}}class l extends d.Gn{constructor(t,e){super(t,e,((t,e,i)=>new h(t,e,i)))}initLinks(t){for(const e of this.eachNode()){const i=e.x,n=e.y;for(let s=0;s<t.length;++s){const o=e.nodes[s];if(o)for(const{dx:e,dy:d,idx:a}of t[s]){const t=i+e,s=n+d,r=this.get(t,s);if(!r)continue;const h=r.nodes[a];o.links.push(h)}}}}}var c=i(157),x=i(76),y=i(737),p=i(953),u=i(914);class g{constructor(t,e){this.src=t,this.dest=e,this.fraction=0}getPos(){const t=this.dest.cx-this.src.cx,e=this.dest.cy-this.src.cy;return{x:this.src.cx+this.fraction*t,y:this.src.cy+this.fraction*e}}reverse(){this.fraction=1-this.fraction,[this.src,this.dest]=[this.dest,this.src]}hasDestTile(){return!!this.dest.tile}hasDestExit(){return!!this.hasDestTile()&&!!u.F.of(r.getExits(this.dest)).map((t=>t[1])).find((t=>t===this.src))}}class f extends s().GameObjects.Sprite{constructor({scene:t,node:e,asset:i}){super(t,e.cx,e.cy,i),this.node=e,this.stepsRemain=0,this.path=null,this.prevNode=null,this.halfwayCheckpoint=!1,this.actionCounter=0}determineNextNode(){return null}onHalfWay(){this.path.hasDestTile()||this.destroy(),this.path.hasDestExit()||this.path.reverse()}onNodeReached(){}followPath(){if(!this.path){this.stepsRemain=this.action.time;const t=this.determineNextNode();if(!t)return void(this.action={type:"SIT",time:40});this.path=new g(this.node,t),this.halfwayCheckpoint=!1}this.path.fraction=1-this.stepsRemain/this.action.time;const t=this.path.getPos();this.x=t.x,this.y=t.y,!this.halfwayCheckpoint&&this.path.fraction>.5&&(this.onHalfWay(),this.halfwayCheckpoint=!0)}completeAction(){"MOVE"===this.action.type&&(this.prevNode=this.node,this.node=this.path.dest,this.path=null,this.onNodeReached()),"onComplete"in this.action&&this.action.onComplete()}determineNextAction(){return{type:"SIT",time:40}}preUpdate(t,e){super.preUpdate(t,e),this.action||(this.action=this.determineNextAction(),this.actionCounter++,this.stepsRemain=this.action.time),"MOVE"===this.action.type&&this.followPath(),"SHAKE"===this.action.type&&(this.x=this.node.cx+4*Math.sin(13*this.stepsRemain),this.y=this.node.cy+4*Math.cos(17*this.stepsRemain)),this.stepsRemain--,this.stepsRemain<=0&&(this.completeAction(),this.action=null)}}class m extends f{constructor({scene:t,node:e}){super({scene:t,node:e,asset:"fluff-spritesheet"}),this.play("fluff")}determineNextNode(){const t=u.F.of(r.getExits(this.node)).map((t=>t[1])).filter((t=>t!==this.prevNode)).collect();return 0===t.length&&this.destroy(),(0,c.d4)(t)}determineNextAction(){if(this.actionCounter>50)return{type:"SIT",time:40,onComplete:()=>{this.destroy()}};const t=Math.min(.5,this.actionCounter/20);return Math.random()<t&&this.node!==this.scene.startNode&&this.node!==this.scene.endNode?{type:"SHAKE",time:120,onComplete:()=>{this.scene.destroyTile(this.node),this.destroy()}}:this.actionCounter%2==1?{type:"MOVE",time:80}:{type:"SIT",time:40}}onHalfWay(){this.path.hasDestTile()?this.path.hasDestExit()||(this.node===this.scene.startNode||this.node===this.scene.endNode||Math.random()>.5?this.path.reverse():(this.stepsRemain=120,this.action={type:"SHAKE",time:120,onComplete:()=>{this.scene.destroyTile(this.node),this.destroy()}})):this.path.reverse()}dragStart(){this.action={type:"SIT",time:1/0}}dragMove(t){this.x=t.x,this.y=t.y}dragRelease(t){const e=this.scene.findNodeAt(t.x,t.y);e&&e.tile?(this.node=e,this.path=null,this.action=null,this.x=e.cx,this.y=e.cy):this.destroy()}}class b extends f{constructor({scene:t,node:e}){super({scene:t,node:e,asset:"banana-spritesheet"}),this.play("banana"),this.solution=t.solution&&t.solution.slice(1)}onNodeReached(){this.node===this.scene.endNode&&(this.scene.endReached(),this.destroy())}determineNextNode(){const t=u.F.of(r.getExits(this.node)).map((t=>t[1])).filter((t=>t!==this.prevNode)).collect();if(0===t.length)return void this.destroy();let e;return e=this.solution&&t.indexOf(this.solution[0])>=0?this.solution.shift():(0,c.d4)(t),e}determineNextAction(){return{type:"MOVE",time:40}}}const v=Math.sqrt(.75),w=Math.PI,S={CAIRO:function(){const t=.5+v,e=v-.5;return{points:[{x:0,y:0},{x:v,y:.5},{x:v-.5,y:v+.5},{x:.5-v,y:v+.5},{x:-v,y:.5}],primitiveUnit:[{x:0,y:0,rotation:0},{x:-e,y:t,rotation:.5*w},{x:0,y:2*t,rotation:w},{x:e,y:t,rotation:1.5*w},{x:2*v+0,y:2*v+0,rotation:0},{x:2*v-e,y:2*v+t,rotation:.5*w},{x:2*v+0,y:2*v+2*t,rotation:w},{x:2*v+e,y:2*v+t,rotation:1.5*w}],unitSize:[4*v,4*v],links:[[{dx:0,dy:-1,idx:5},{dx:0,dy:0,idx:3},{dx:0,dy:0,idx:2},{dx:0,dy:0,idx:1},{dx:-1,dy:-1,idx:7}],[{dx:0,dy:0,idx:2},{dx:-1,dy:0,idx:4},{dx:-1,dy:0,idx:3},{dx:-1,dy:-1,idx:6},{dx:0,dy:0,idx:0}],[{dx:-1,dy:0,idx:7},{dx:0,dy:0,idx:1},{dx:0,dy:0,idx:0},{dx:0,dy:0,idx:3},{dx:0,dy:0,idx:5}],[{dx:0,dy:0,idx:0},{dx:0,dy:-1,idx:6},{dx:1,dy:0,idx:1},{dx:0,dy:0,idx:4},{dx:0,dy:0,idx:2}],[{dx:1,dy:0,idx:1},{dx:0,dy:0,idx:7},{dx:0,dy:0,idx:6},{dx:0,dy:0,idx:5},{dx:0,dy:0,idx:3}],[{dx:0,dy:0,idx:6},{dx:0,dy:1,idx:0},{dx:-1,dy:0,idx:7},{dx:0,dy:0,idx:2},{dx:0,dy:0,idx:4}],[{dx:0,dy:1,idx:3},{dx:0,dy:0,idx:5},{dx:0,dy:0,idx:4},{dx:0,dy:0,idx:7},{dx:1,dy:1,idx:1}],[{dx:0,dy:0,idx:4},{dx:1,dy:0,idx:2},{dx:1,dy:0,idx:5},{dx:1,dy:1,idx:0},{dx:0,dy:0,idx:6}]],name:"CAIRO",sides:5}}(),DIAMOND:{points:[{x:0,y:0},{x:0,y:1},{x:v,y:1.5},{x:v,y:.5}],primitiveUnit:[{x:0,y:0,rotation:0},{x:2*v,y:0,rotation:2*w/3},{x:v,y:1.5,rotation:4*w/3},{x:-v,y:1.5,rotation:0},{x:v,y:1.5,rotation:2*w/3},{x:0,y:3,rotation:4*w/3}],unitSize:[2*v,3],links:[[{dx:0,dy:0,idx:1},{dx:0,dy:0,idx:2},{dx:0,dy:0,idx:4},{dx:-1,dy:0,idx:2}],[{dx:0,dy:0,idx:2},{dx:0,dy:0,idx:0},{dx:0,dy:-1,idx:5},{dx:1,dy:-1,idx:3}],[{dx:0,dy:0,idx:0},{dx:0,dy:0,idx:1},{dx:1,dy:0,idx:0},{dx:1,dy:0,idx:4}],[{dx:0,dy:0,idx:4},{dx:0,dy:0,idx:5},{dx:-1,dy:1,idx:1},{dx:-1,dy:0,idx:5}],[{dx:0,dy:0,idx:5},{dx:0,dy:0,idx:3},{dx:-1,dy:0,idx:2},{dx:0,dy:0,idx:0}],[{dx:0,dy:0,idx:3},{dx:0,dy:0,idx:4},{dx:1,dy:0,idx:3},{dx:0,dy:1,idx:1}]],name:"DIAMOND",sides:4},SQUARE:{points:[{x:0,y:0},{x:1.5,y:0},{x:1.5,y:1.5},{x:0,y:1.5}],primitiveUnit:[{x:0,y:0,rotation:0}],unitSize:[1.5,1.5],links:[[{dx:0,dy:-1,idx:0},{dx:1,dy:0,idx:0},{dx:0,dy:1,idx:0},{dx:-1,dy:0,idx:0}]],name:"SQUARE",sides:4},HEXAGONAL:{points:[{x:0,y:0},{x:0,y:1},{x:v,y:1.5},{x:2*v,y:1},{x:2*v,y:0},{x:v,y:-.5}],primitiveUnit:[{x:0,y:0,rotation:0},{x:-v,y:1.5,rotation:0}],unitSize:[2*v,3],links:[[{dx:1,dy:-1,idx:1},{dx:1,dy:0,idx:0},{dx:1,dy:0,idx:1},{dx:0,dy:0,idx:1},{dx:-1,dy:0,idx:0},{dx:0,dy:-1,idx:1}],[{dx:0,dy:0,idx:0},{dx:1,dy:0,idx:1},{dx:0,dy:1,idx:0},{dx:-1,dy:1,idx:0},{dx:-1,dy:0,idx:1},{dx:-1,dy:0,idx:0}]],name:"HEXAGONAL",sides:6},TRIANGULAR:{points:[{x:0,y:0},{x:1,y:2*v},{x:2,y:0}],primitiveUnit:[{x:0,y:0,rotation:0},{x:1,y:2*v,rotation:w},{x:-1,y:2*v,rotation:0},{x:2,y:4*v,rotation:w}],unitSize:[2,4*v],links:[[{dx:0,dy:-1,idx:3},{dx:1,dy:0,idx:1},{dx:0,dy:0,idx:1}],[{dx:0,dy:0,idx:2},{dx:-1,dy:0,idx:0},{dx:0,dy:0,idx:0}],[{dx:0,dy:0,idx:1},{dx:0,dy:0,idx:3},{dx:-1,dy:0,idx:3}],[{dx:0,dy:1,idx:0},{dx:0,dy:0,idx:2},{dx:1,dy:0,idx:2}]],name:"TRIANGULAR",sides:3}},k=64;function T(t){return{x:t.reduce(((t,e)=>t+e.x),0)/t.length,y:t.reduce(((t,e)=>t+e.y),0)/t.length}}const N={};function R(t){for(const e of Object.values(S)){N[e.name]=[];for(let i=0;i<Math.pow(2,e.sides);++i)A(t,e,i)}}function A(t,e,i){const n=`tile-${e.name}-${i}`,o=t.make.graphics({x:0,y:0,add:!1}),{points:d}=e,r=T(d),h=function(t){return{top:Math.min(...t.map((t=>t.y))),left:Math.min(...t.map((t=>t.x))),bottom:Math.max(...t.map((t=>t.y))),right:Math.max(...t.map((t=>t.x)))}}(d),l=-h.left*k+8,c=-h.top*k+8,x=(h.right-h.left)*k+16,y=(h.bottom-h.top)*k+16;!function(t,e,i,n,o,d,r,h){const{points:l,links:c,primitiveUnit:x,unitSize:y}=n,p=T(l),u=(0,a.vs)((0,a.Iu)(e,i),(0,a.bA)(k,k)),g=(0,a.qU)(u,l),f=new(s().Geom.Polygon)(g);t.fillStyle(4500036),t.fillPoints(f.points,!0);const m=c[0];let b=1;for(const{dx:n,dy:s,idx:d}of m){if(0==(o&b)){b*=2;continue}b*=2,t.lineStyle(8,13421704);const r=x[d],h=n*y[0]+r.x,l=s*y[1]+r.y,c=(0,a.vs)((0,a.Iu)(e,i),(0,a.bA)(k,k),(0,a.Iu)(h,l),(0,a.U1)(r.rotation)),g=(0,a.hC)(u,p),f=(0,a.hC)(c,p);t.lineBetween(g.x,g.y,(f.x+g.x)/2,(f.y+g.y)/2)}t.lineStyle(3,3377203),t.strokePoints(f.points,!0)}(o,l,c,e,i),o.generateTexture(n,x,y),N[e.name][i]={resKey:n,connectionMask:i,origin:{x:l,y:c},center:{x:l+r.x*k,y:c+r.y*k}}}class E{constructor({scene:t,layer:e,x:i,y:n,w:s,h:o,value:d=0,max:a=1}){this.graphics=t.make.graphics(),this.x=i,this.y=n,this.w=s,this.h=o,this.refresh(d,a),e.add(this.graphics)}refresh(t,e){this.graphics.clear(),this.graphics.fillStyle(8421504,.5),this.graphics.fillRect(this.x,this.y,this.w,this.h),this.graphics.fillStyle(16776960,1);const i=t/e;this.graphics.fillRect(this.x,this.y,this.w*i,this.h),this.graphics.lineStyle(3,8421504),this.graphics.strokeRect(this.x,this.y,this.w,this.h)}}const L=class extends s().GameObjects.Sprite{constructor({scene:t,x:e,y:i,tile:n}){super(t,e,i,n.resKey),this.grabPoint=null}preUpdate(){}dragStart(t){this.grabPoint={x:t.x-this.x,y:t.y-this.y}}dragMove(t){this.x=t.x,this.y=t.y}rotateLeft(){const t=this.scene.tesselation.sides;this.rotation-=2*Math.PI/t}rotateRight(){const t=this.scene.tesselation.sides;this.rotation+=2*Math.PI/t}dragRelease(t){const e=this.scene,i=e.findNodeAt(this.x,this.y);if(i&&!i.tile){const t=this.scene.tesselation.sides,n=function(t,e){let i=t;const n=2*Math.PI,s=n/e;for(;i<0;)i+=n;return Math.round(i/s)%e}(this.rotation,t),s=function(t,e,i){const n=1<<i;let s=t;for(let t=0;t<e;++t)s<<=1,(s&n)>0&&(s-=n-1);return s}(e.nextTile.connectionMask,n,t);e.setTile(i,e.tileSet[s]),e.updateNextTile()}else e.tweens.add({targets:[this],duration:200,x:e.control.x,y:e.control.y})}};class O extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n\t\t<style>\n\t\t\t.Backdrop {\n\t\t\t\tbackground: #666;\n\t\t\t\theight: 100%;\n\t\t\t\tz-index: 1000;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\n\t\t\t.Container {\n\t\t\t\theight: 100%;\n\t\t\t\twidth: 100%;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\n\t\t\t\tposition: fixed;\n\t\t\t\tbottom: 0px;\n\t\t\t\tz-index: 1001;\n\t\t\t\topacity: 1;\n\t\t\t}\n\n\t\t\t.Dialog {\n\t\t\t\tbackground: #fff;\n\t\t\t\tborder: 1px solid #dedede;\n\n\t\t\t\tfont-family: Helvetica,Tahoma,Arial,sans-serif;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tline-height: 1.4;\n\n\t\t\t\tmax-width: 80%;\n\t\t\t\tmax-height: 80%;\n\t\t\t}\n\t\t\n\t\t\tdiv {\n\t\t\t\tmargin: 0;\n\t\t\t\tpadding: 0;\n\t\t\t\ttext-align: left;\n\t\t\t}\n\t\t\n\t\t\t.Dialog_Body {\n\t\t\t\toverflow: hidden auto;\n\t\t\t\t-webkit-overflow-scrolling: touch;\n\t\t\t\tcolor: #44484a;\n\t\t\t\tmargin: 10px;\n\t\t\t\tpadding: 20px;\n\t\t\t\tpadding-left: 20px;\n\t\t\t\tmin-height: 64px;\n\t\t\t\tmin-width: 128px;\n\t\t\t}\n\n\t\t\t.Dialog_Buttons {\n\t\t\t\ttext-align: right;\n\t\t\t\tpadding: 10px 5px 10px 10px;\n\t\t\t}\n\n\t\t\t.Dialog_Buttons a:hover {\n\t\t\t\tbackground: #224467;\n\t\t\t\tcolor: #fff;\n\t\t\t}\n\n\t\t\t.Dialog_Buttons a {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\tzoom: 1;\n\t\t\t\t*display: inline;\n\t\t\t\tbackground: #516270;\n\t\t\t\tcolor: #fff;\n\t\t\t\tfont-weight: 700;\n\t\t\t\tmargin-right: 5px !important;\n\t\t\t\tmin-width: 60px;\n\t\t\t\tpadding: 10px 15px;\n\t\t\t\ttext-align: center;\n\t\t\t\ttext-decoration: none;\n\t\t\t}\n\t\t\t\n\t\t\t.Dialog * {\n\t\t\t\t-moz-box-sizing: content-box !important;\n\t\t\t\t-webkit-box-sizing: content-box !important;\n\t\t\t\tbox-sizing: content-box !important;\n\t\t\t}\n\t\t</style>\n\t\n\t\t<div class="Backdrop" style="position: fixed; left: 0px; top: 0px; opacity: 0.4;"></div>\n\n\t\t<div class="Container">\n\t\t\t<div class="Dialog">\n\t\t\t\t<div class="Dialog_Body">\n\t\t\t\t\t<slot></slot>\n\t\t\t\t</div>\n\t\t\t\t<div class="Dialog_Buttons">\n\t\t\t\t\t<a href="javascript:void(0)" id="Dialog_Button_0">Ok</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t',this.shadowRoot.getElementById("Dialog_Button_0").addEventListener("click",(t=>{this.callback(t),this.remove()}))}}customElements.define("helix-dialog",O);const M=[{dialog:"\n<h2>Fole and Raul, our heroes</h2>\n<p>\nAfter years of adventuring in deep space,\nFole and Raul are ready to return home.\n</p>\n<p>\nAll they have to now, is load up their precious cargo.\nThe flowers are already in the ship...\n</p>\n<p>\nThey are ready to move a load of bananas.\nBut wait, what's that?\n</p>\n<p>\nThere are indiginous life forms here.\nThey are fluffy.\nAnd they sure love bananas!\n</p>\n<h2>How to play</h2>\nDRAG your tile from the TOP-RIGHT corner.\nROTATE before you drag, by clicking the L or R buttons.\nCreate a path, but be careful that the fluffs don't sabotage it.\nIf the fluffs get too annoying, DRAG them away.\n",tesselation:S.SQUARE.name},{dialog:"\n<h2>Intermission</h2>\n<p>\nBoy, the geometry of this place is weird, isn't it?\nIt reminds me of someone...\n<p>",tesselation:S.HEXAGONAL.name},{dialog:'<h2>SHAMELESS PLUG</h2>\n\t\t<p>Do you like the hexagonal music?\n\t\t</p><p>\n\t\tFollow <a href="https://twitter.com/donall">@Donall</a> on twitter!\n\t\t</p>',tesselation:S.TRIANGULAR.name},{dialog:'<h2>SHAMELESS PLUG</h2>\n\t\t<p>\n\t\tDo you want to know the backstory?\n\t\t</p><p>\n\t\tHow did our two heroes got into this mess?\n\t\tPlay <a href="https://tins.amarillion.org/entry/205/">Fole and Raul go Flower Power</a>, and find out!</p>',tesselation:S.CAIRO.name},{tesselation:S.DIAMOND.name,dialog:'<h2>SHAMELESS PLUG</h2>\n\t\t<p>Did you enjoy TINS?</p>\n\t\t<p>\n\t\tJoin <a href="https://tins.amarillion.org/">KrampusHack</a> this December, \n\t\ta relaxed, secret-santa-style Game Jam by the origanizers of TINS\n\t\twhere you make a game as a gift for somebody else.\n\t\t</p>\n\t\t'}];class C extends s().Scene{constructor(){super({key:"GameScene"})}debugPrimaryUnitRectangle(t){const e=new(s().GameObjects.Rectangle)(this,t.xco,t.yco,t.unitSize[0]*k,t.unitSize[1]*k);e.isFilled=!1,e.isStroked=!0,e.setStrokeStyle(3,11176072,1),this.bgLayer.add(e),e.setOrigin(0,0),console.log({xco:t.xco,yco:t.yco,w:t.unitSize[0],h:t.unitSize[1],rect:e})}renderPolygons(t){for(const e of t.eachNode())for(const t of e.nodes){const{points:e}=t,i=new(s().GameObjects.Polygon)(this,0,0,e,0,1);i.setOrigin(0,0),i.isFilled=!1,i.isStroked=!0,i.setStrokeStyle(3,10526880,1),this.bgLayer.add(i),t.delegate=i}}initGates(){this.startNode=this.findNodeAt(150,150),this.setTile(this.startNode,this.tileSet[this.tileSet.length-1]);const t=new(s().GameObjects.Sprite)(this,this.startNode.cx,this.startNode.cy,"startgate");this.spriteLayer.add(t),this.endNode=this.findNodeAt(650,300),this.setTile(this.endNode,this.tileSet[this.tileSet.length-1]);const e=new(s().GameObjects.Sprite)(this,this.endNode.cx,this.endNode.cy,"endgate");this.spriteLayer.add(e)}onRotateLeft(){this.uiBlocked||this.draggableTile&&this.draggableTile.rotateLeft()}onRotateRight(){this.uiBlocked||this.draggableTile&&this.draggableTile.rotateRight()}initUI(){const t=new(s().GameObjects.Ellipse)(this,740,60,115,115,8947848,.5);t.setStrokeStyle(2,0),this.control=t,this.uiLayer.add(t);const e=new(s().GameObjects.Text)(this,680,120,"[L]",{backgroundColor:"#00f",color:"#fff",fontSize:"32px"});e.setInteractive().on("pointerdown",(()=>this.onRotateLeft())),this.uiLayer.add(e);const i=new(s().GameObjects.Text)(this,740,120,"[R]",{backgroundColor:"#00f",color:"#fff",fontSize:"32px"});i.setInteractive().on("pointerdown",(()=>this.onRotateRight())),this.uiLayer.add(i),this.progressbar=new E({scene:this,layer:this.uiLayer,x:695,y:395,w:100,h:50})}addReusableAnimations(){this.anims.create({key:"fluff",frames:this.anims.generateFrameNumbers("fluff-spritesheet",{frames:[0,1]}),frameRate:5,repeat:-1}),this.anims.create({key:"banana",frames:this.anims.generateFrameNumbers("banana-spritesheet",{frames:[0,1]}),frameRate:5,repeat:-1})}initLevel(){this.children.removeAll(),this.bgLayer=this.add.layer(),this.bgLayer.setDepth(0),this.tileLayer=this.add.layer(),this.tileLayer.setDepth(1),this.spriteLayer=this.add.layer(),this.spriteLayer.setDepth(2),this.uiLayer=this.add.layer(),this.uiLayer.setDepth(3),this.fluffs=this.add.group(),this.score=0;const t=M[this.level%M.length];this.tesselation=S[t.tesselation],this.grid=function(t){const{unitSize:e,links:i}=t,n=Math.ceil(12.5/e[0]),s=Math.ceil(7.03125/e[1]);let o=0;const d=new l(n,s);for(let i=0;i<s;++i){let s=0;for(let a=0;a<n;++a)d.get(a,i).addPrimitiveUnit(a,i,s,o,t,k),s+=e[0]*k;o+=e[1]*k}return d.initLinks(i),d}(this.tesselation),this.renderPolygons(this.grid),this.tileSet=N[this.tesselation.name],this.noDeadEnds=this.tileSet.filter((t=>!(t.connectionMask in{0:0,1:1,2:2,4:4,8:8,16:16,32:32,64:64}))),this.initGates(),this.initUI(),this.updateNextTile(),(0,x.h)(null!==this.startNode),(0,x.h)(null!==this.endNode),t.dialog&&(this.uiBlocked=!0,function(t,e=(()=>{})){const i=document.createElement("helix-dialog");i.innerHTML=t,i.callback=e,document.body.appendChild(i)}(t.dialog,(()=>{this.uiBlocked=!1})))}endReached(){if(this.score++,this.progressbar.refresh(this.score,50),50===this.score){const t=new(s().GameObjects.Text)(this,400,225,"LEVEL COMPLETE",{color:"black",align:"center"});this.uiLayer.add(t),setTimeout((()=>{this.level++,this.initLevel(),t.destroy()}),3e3)}}debugAdjacent(t){t.delegate.isFilled=!0;let e=0;for(const[,i]of r.getAdjacent(t)){const t=i.delegate;setTimeout((()=>t.isFilled=!0),200*(e+2)),setTimeout((()=>t.isFilled=!1),200*(e+3)),e++}setTimeout((()=>t.delegate.isFilled=!1),100),console.log(`{ dx: ${t.mx-1}, dy: ${t.my-1}, idx: ${t.idx} },`)}addMob(){if(this.uiBlocked)return;const t={scene:this,node:this.startNode},e=new b(t);this.spriteLayer.add(e),this.spawnFluff()}spawnFluff(){let t=0;this.score>25&&(t=1),this.score>40&&(t=2);do{const t=this.grid.randomCell(),e=(0,c.d4)(t.nodes);if(e.tile){const t=new m({scene:this,node:e});this.spriteLayer.add(t),this.fluffs.add(t),console.log("Added fluff",this.fluffs.children.size)}}while(this.fluffs.children.size<t)}findNodeAt(t,e){for(const i of this.grid.eachNode())for(const n of i.nodes){if(!n.delegate)continue;const i=n.delegate;if(s().Geom.Polygon.Contains(i.geom,t,e))return n}return null}setTile(t,e){t.tile=e;const i=new(s().GameObjects.Image)(this,t.xco,t.yco,t.tile.resKey);i.setDisplayOrigin(e.origin.x,e.origin.y),i.rotation=t.element.rotation,t.tileImg=i,this.tileLayer.add(i),this.checkPath()}destroyTile(t){if(t===this.startNode||t===this.endNode)return;const e=t.tileImg,i=t.tile;i&&e&&(e.setPosition(t.xco-i.origin.x+i.center.x,t.yco-i.origin.y+i.center.y),e.setDisplayOrigin(i.center.x,i.center.y),this.tweens.add({targets:[e],duration:1e3,rotation:Math.PI,scale:0,onComplete:()=>e.destroy()}),t.tile=null,t.tileImg=null)}checkPath(){const t=(0,p.Zw)(this.startNode,this.endNode,r.getAdjacent);this.solution=(0,y.op)(this.startNode,this.endNode,t),this.solution&&console.log(this.solution)}updateNextTile(){this.nextTile=(0,c.d4)(this.noDeadEnds),this.draggableTile&&this.draggableTile.destroy(),this.draggableTile=new L({scene:this,x:740,y:60,tile:this.nextTile}),this.uiLayer.add(this.draggableTile)}create(){this.addReusableAnimations(),this.level=0,this.uiBlocked=!1,R(this),this.time.addEvent({delay:1e3,callback:()=>this.addMob(),loop:!0}),this.initLevel(),this.input.on("pointerdown",(t=>{this.onDown(t)})),this.input.on("pointermove",(t=>this.onMove(t))),this.input.on("pointerup",(t=>this.onRelease(t))),this.sound.add("music",{loop:!0}).play()}onDown(t){if(this.uiBlocked)return;const e=t.x-this.control.x+this.control.displayOriginX,i=t.y-this.control.y+this.control.displayOriginY;if(s().Geom.Ellipse.Contains(this.control.geom,e,i))return this.dragTarget=this.draggableTile,void this.dragTarget.dragStart(t);for(const e of this.fluffs.children.getArray()){const i=e,n=i.getCenter(),s=t.x-n.x,o=t.y-n.y;if(Math.abs(s)<64&&Math.abs(o)<64)return this.dragTarget=i,void this.dragTarget.dragStart(t)}}onMove(t){this.uiBlocked||this.dragTarget&&this.dragTarget.dragMove(t)}onRelease(t){this.uiBlocked||this.dragTarget&&(this.dragTarget.dragRelease(t),this.dragTarget=null)}}function D(t,e,i,n=!1){return t.addEventListener(e,i,n),()=>{t.removeEventListener(e,i,n)}}class I extends n.Scene{constructor(){super({key:"MenuScene"})}async create(){document.querySelector("div#wrapper").style="display: none;",document.querySelector("game-menu").style="display: visible;",this.component=document.querySelector("game-menu"),this.unregister=[D(this.component,"Start",(()=>this.startGame()))],this.events.on("shutdown",(()=>this.shutdown()))}startGame(){this.scene.start("GameScene")}shutdown(){this.unregister.forEach((t=>t())),document.querySelector("game-menu").style="display: none;",document.querySelector("div#wrapper").style="display: visible;"}}const G=i.p+"50d27cadd9fef9fca21e42604bfcb876.png";var P=i(592);class B extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.render()}render(){this.shadowRoot.innerHTML=`\n\t\t<style>\n\t\t\t:host {\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t\theight: 100vh;\n\n\t\t\t\tbackground-image: url(${G});\n\t\t\t\tbackground-position: center;\n\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\tbackground-size: contain;\n\t\t\t}\n\n\t\t\tbutton {\n\t\t\t\tbackground-color: #4C50AF; /* Blue */\n\t\t\t\tborder: none;\n\t\t\t\tcolor: white;\n\t\t\t\ttext-align: center;\n\t\t\t\ttext-decoration: none;\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tfont-size: 16px;\n\t\t\t\tmargin: 2rem;\n\t\t\t\twidth: 10rem;\n\t\t\t\theight: 4rem;\n\t\t\t}\n\t\t\tbutton:hover {\n\t\t\t\tbackground-color: #6C70DF; /* Blue */\n\t\t\t}\n\t\t\t.main {\n\t\t\t\tposition: absolute;\n\t\t\t\tleft: 30%;\n\t\t\t\ttop: 20%;\n\t\t\t}\n\t\t\t.qrwrapper {\n\t\t\t\tposition: absolute;\n\t\t\t\tright: 1rem;\n\t\t\t\ttop: 1rem;\n\t\t\t\ttext-align: center;\n\t\t\t}\n\t\t\t.buttonBar {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t}\n\t\t</style>\n\n\t\t<div class="main">\n\t\t\t<div class="buttonBar">\n\t\t\t\t<button id="startGame">Start Game</button>\n\t\t\t\t<button id="fullScreen">Full Screen</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="qrwrapper">\n\t\t\t<small>play on mobile!</small><br>\n\t\t\t<canvas id="qrcanvas"></canvas>\n\t\t</div>\n\t`}connectedCallback(){this.shadowRoot.querySelector("#startGame").addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("Start")),this.dispatchEvent(new CustomEvent("button-pressed"))})),this.shadowRoot.querySelector("#fullScreen").addEventListener("click",(()=>{document.documentElement.requestFullscreen({navigationUI:"show"}).then((()=>{})).catch((t=>{alert(`An error occurred while trying to switch into full-screen mode: ${t.message} (${t.name})`)}))}));const t=this.shadowRoot.getElementById("qrcanvas");P.toCanvas(t,window.location.toString(),(function(t){t&&console.error(t)}))}}class U extends s().Scene{constructor(){super({key:"DebugTilesScene"})}preload(){}debugTilesPreview(){let t=64,e=64;for(const i of Object.keys(N).map((t=>N[t][0]))){console.log(i);const n=this.add.image(t,e,i.resKey);n.setOrigin(0,0),n.setPosition(t,e),this.add.existing(n),console.log({img:n});const s=this.add.rectangle(t,e,n.width,n.height,0);s.setOrigin(0,0),s.isFilled=!1,s.setStrokeStyle(1,255),s.isStroked=!0,this.add.circle(t+i.origin.x,e+i.origin.y,5,65535),this.add.circle(t+i.center.x,e+i.center.y,5,16711935),t+=128,t>800&&(e+=128,t=64)}this.input.on("pointermove",(t=>{console.log(t)}))}create(){R(this),this.debugTilesPreview()}}const j={type:n.AUTO,parent:"content",disableContextMenu:!0,backgroundColor:"#dddddd",width:800,height:450,localStorageName:"tins21-amarillion",fps:{target:60},scale:{mode:n.Scale.FIT,autoCenter:n.Scale.CENTER_BOTH,parent:"content"},scene:[o,C,I,U]};class z extends n.Game{constructor(){super(j)}}customElements.define("game-menu",B),window.game=new z}},i={};function n(t){var s=i[t];if(void 0!==s)return s.exports;var o=i[t]={exports:{}};return e[t].call(o.exports,o,o.exports,n),o.exports}n.m=e,t=[],n.O=(e,i,s,o)=>{if(!i){var d=1/0;for(l=0;l<t.length;l++){for(var[i,s,o]=t[l],a=!0,r=0;r<i.length;r++)(!1&o||d>=o)&&Object.keys(n.O).every((t=>n.O[t](i[r])))?i.splice(r--,1):(a=!1,o<d&&(d=o));if(a){t.splice(l--,1);var h=s();void 0!==h&&(e=h)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[i,s,o]},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),(()=>{var t={143:0};n.O.j=e=>0===t[e];var e=(e,i)=>{var s,o,[d,a,r]=i,h=0;for(s in a)n.o(a,s)&&(n.m[s]=a[s]);if(r)var l=r(n);for(e&&e(i);h<d.length;h++)o=d[h],n.o(t,o)&&t[o]&&t[o][0](),t[d[h]]=0;return n.O(l)},i=self.webpackChunktins21_entry=self.webpackChunktins21_entry||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var s=n.O(void 0,[911],(()=>n(785)));s=n.O(s)})();